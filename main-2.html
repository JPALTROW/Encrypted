<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="David Jiang" />
  <title>Counting Cards</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      word-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Counting Cards</h1>
<p class="author">David Jiang</p>
</header>
<h1 id="introduction">Introduction</h1>
<p>Not many people make a career off of gambling, and those who do certainly aren’t playing some rigged game like slots. Many astute gamblers rely on probability and statistics to feed their families, but how do they do it?</p>
<h1 id="the-game">The Game</h1>
<h2 id="basic-rules-u.s.-version">Basic Rules (U.S. Version)</h2>
<p>Blackjack is a card game you can find in casinos virtually everywhere. Here are the basics:</p>
<ol>
<li><p>Number cards (i.e. cards <span class="math inline">\(2\)</span> through <span class="math inline">\(10\)</span>) are valued by their number, face cards are valued at <span class="math inline">\(10,\)</span> and aces can be either <span class="math inline">\(1\)</span> or <span class="math inline">\(11.\)</span></p></li>
<li><p>Each player is given <span class="math inline">\(2\)</span> cards face up, while the dealer has <span class="math inline">\(1\)</span> card face up and <span class="math inline">\(1\)</span> card face down.</p></li>
<li><p>Players can continuously ask for cards to get closest to <span class="math inline">\(21\)</span> without exceeding <span class="math inline">\(21.\)</span></p></li>
<li><p>Whoever is closest to <span class="math inline">\(21\)</span> (without going over) wins.</p></li>
<li><p>When someone is given an ace and <span class="math inline">\(10\)</span>-valued card, it is called a blackjack.</p></li>
</ol>
<p>In casinos, dealers can use anywhere from <span class="math inline">\(1\)</span> to <span class="math inline">\(8\)</span> decks. Usually, they check for a blackjack first, and if there is one, the dealer will show the cards and the players lose; otherwise, after the players are done collecting their cards, the dealer flips over their down card and does the designated moves. If the player busts, or goes over <span class="math inline">\(21,\)</span> they automatically lose, regardless of what the dealer has. A push occurs if the player and dealer has the same amount, and no money is lost or gained.</p>
<h2 id="vocabulary">Vocabulary</h2>
<p>Finally, here’s some vocabulary that may be used during a game of blackjack:</p>
<ul>
<li><p><strong>Hit:</strong> Take another card.</p></li>
<li><p><strong>Stand:</strong> Stay at the value.</p></li>
<li><p><strong>Double down:</strong> Double the bet and take one more card.</p></li>
<li><p><strong>Split:</strong> Make <span class="math inline">\(2\)</span> separate hands from an original hand with cards of the same value.</p></li>
<li><p><strong>Surrender:</strong> Give up and lose only half of the bet.</p></li>
<li><p><strong>Soft Hand:</strong> Hand value can change (i.e. contains an ace).</p></li>
<li><p><strong>Hard Hand:</strong> Hand value can’t change (i.e. does not contain an ace).</p></li>
</ul>
<p>With a clearer understanding of blackjack, we can dive into the more important stuff: making the money.</p>
<h1 id="card-counting">Card Counting</h1>
<h2 id="motivation">Motivation</h2>
<p>Card counting is founded on the basis of conditional probability: since cards are discarded after every round, someone could, in theory, take what they already know about the deck of cards to change their bet and maximize their profits.</p>
<p>More high cards in the deck benefits the players; it increases the chances of getting a blackjack along with the chances of the dealer busting, and it gives more opportunities for splitting and better results through doubling down. More lower cards in the deck benefit the dealer: they have a smaller chance of busting from <span class="math inline">\(12-16\)</span>s and they ultimately benefit the players less (thereby benefiting the dealer more).</p>
<h2 id="strategy">Strategy</h2>
<p>Card counters have devised strategies to estimate the proportions of high to low value cards in the deck by assigning point values to each card. Lower value cards on the table are set at a positive point value because this results with more high-value cards in the deck, and vice-versa for high-value cards. A good example of this is the Hi-Lo system.</p>
<ul>
<li><p>aces and face cards have a <span class="math inline">\(-1\)</span> point value</p></li>
<li><p>cards <span class="math inline">\(7-9\)</span> have a <span class="math inline">\(0\)</span> point value</p></li>
<li><p>cards <span class="math inline">\(2-6\)</span> have a <span class="math inline">\(+1\)</span> point value</p></li>
</ul>
<p>Counting systems are measured in levels, which is how much the count can change based on the system. For more clarity, here’s an example: the Hi-Lo system (the system above) is a level <span class="math inline">\(1\)</span> system since the count can change by at most <span class="math inline">\(1\)</span> point value. The Zen system, on the other hand, is a level <span class="math inline">\(2\)</span> system, since <span class="math inline">\(4,\)</span> <span class="math inline">\(5,\)</span> and <span class="math inline">\(6\)</span> are valued at <span class="math inline">\(+2\)</span> and <span class="math inline">\(10\)</span>s are valued at <span class="math inline">\(-2,\)</span> so the count can change by at most <span class="math inline">\(2\)</span> point values. Higher level systems correspond to more accurate measures of the projected impact on the house after removing a card, but they are also harder to keep track of.</p>
<p>After choosing a strategy, make sure to check whether or not the system is balanced. Balanced systems are set in a way such that the sum of all assigned values is equal to <span class="math inline">\(0.\)</span> Again, we can use the Hi-Lo system as an example: <span class="math display">\[(-1)(5\cdot4) + (0)(3\cdot4) + (1)(5\cdot4) = 0,\]</span> so the Hi-Lo system is balanced. The original count based on the point values will be called the <em>running count</em>. The <em>true count</em> takes into consideration how many decks are being played by dividing the running count by the remaining number of decks. Of course, only on rare occurrences will the true count be an integer, so flooring the true count is fine — it will be close enough.</p>
<h2 id="basic-blackjack-strategy">Basic Blackjack Strategy</h2>
<p>In Blackjack, players have the freedom to do whatever they want once they have their initial two cards. To maximize profits, players should follow basic blackjack strategy to bring the house edge, or statistical advantage for the casino, down. Below is a chart that highlights each case you may encounter and what to do (Note: the up-card is the dealer’s face up card).</p>
<figure>
<img src="basic-strategy.png" style="width:5cm" alt="Blackjack Basic Strategy" /><figcaption aria-hidden="true">Blackjack Basic Strategy</figcaption>
</figure>
<p>We can try proving that these are the most optimal choices. Though computer simulations are better for calculating these moves as they consider every case possible, calculating by hand in a hypothetical situation gives a rough sketch of what the most optimal move is. The calculations themselves are rather bashy, but running them in excel should speed up the process.</p>
<p>For simplicity, we assume that we have an infinite amount of decks, and we will only consider what would happen if we hit or stand. We first calculate the probabilities of the dealer getting a certain value given their up card. In total, there are only <span class="math inline">\(6\)</span> outcomes: getting a <span class="math inline">\(17, 18, 19, 20, 21\)</span> or bust.</p>
<h3 class="unnumbered" id="proof">Proof</h3>
<p>We will define <span class="math inline">\(P_{(k, o, h)}\)</span> as the probability of achieving outcome <span class="math inline">\(o\)</span> with a hard <span class="math inline">\(k\)</span> and <span class="math inline">\(P_{(k, o, v)}\)</span> as the probability of achieving outcome <span class="math inline">\(o\)</span> with a soft <span class="math inline">\(k.\)</span> We will denote busting as <span class="math inline">\(B\)</span> for simplicity. Then, we have more or less a states problem. Note that <span class="math inline">\(P_{(17,17,h)} = P_{(17,17,v)} = P_{(27,17,v)} = 1,\)</span> and similarly for the remaining numerical outcomes. Any hard value above <span class="math inline">\(21,\)</span> such as <span class="math inline">\(P_{(22,B,h)},\)</span> is equal to <span class="math inline">\(1.\)</span> Finally, we notice that any soft value above <span class="math inline">\(21\)</span> is equal to the hard value of <span class="math inline">\(10\)</span> less than it (<span class="math inline">\(P_{(u,o,v)} = P_{(u-10,o,h)}\)</span>).</p>
<p>Let’s start with <span class="math inline">\(P_{(2,o,h)}.\)</span> After drawing a card, it has <span class="math inline">\(\frac{1}{13}\)</span> chance of getting to <span class="math inline">\(P_{(13,o,v)}\)</span> and each of <span class="math inline">\(P_{(4,o,h)}\)</span> through <span class="math inline">\(P_{(11,o,h)}.\)</span> There is a <span class="math inline">\(\frac{4}{13}\)</span> chance (since there are <span class="math inline">\(4\)</span> ranks of value <span class="math inline">\(10\)</span>) of getting <span class="math inline">\(P_{(12,o,h)}.\)</span> Thus, we have that <span class="math display">\[P_{(2,o,h)} = \frac{1}{13} \sum_{i=4}^{11} P_{(i,o,h)} + \frac{4}{13} P_{(12,o,h)} + \frac{1}{13} P_{(13,o,v)}.\]</span> We can do a similar process for the remaining <span class="math inline">\(P_{(i,o,h)}\)</span> for <span class="math inline">\(2 \le i \le 16\)</span> and solve for each probability. Running this in Excel, we can find the probability of getting our outcome from a specific up card (working by hand is possible, but it is very, very time consuming).</p>
<p><img src="Dealer1.png" style="width:10cm" alt="image" /></p>
<p>Now, we must consider when the up card is <span class="math inline">\(10\)</span> or <span class="math inline">\(A,\)</span> when the dealers check for natural blackjacks. Thus, we only need to consider the hard values when working with <span class="math inline">\(10.\)</span> This gives the equation <span class="math display">\[P_{(10,o,h)} = \frac{1}{12} \sum_{i=12}^{19} P_{(i,o,h)} + \frac{4}{12} P_{(20,o,h)}.\]</span> It’s similar for <span class="math inline">\(A,\)</span> but you only have soft values that can go from <span class="math inline">\(P_{(12,o,v)}\)</span> to <span class="math inline">\(P_{(20,o,v)}.\)</span> This gives you <span class="math inline">\(9\)</span> total choices, each with equal probability. Inputting these values into Excel, we get</p>
<p><img src="Dealer2.png" style="width:10cm" alt="image" /></p>
<p>Now, we’ll find the expected values from standing for each combination, and compare them to hitting. Let’s first consider standing. We will define the expected winnings percentage from standing as <span class="math inline">\(S_{(u,k,h)}\)</span> and <span class="math inline">\(S_{(u,k,v)},\)</span> where <span class="math inline">\(k\)</span> is the value the player has, <span class="math inline">\(u\)</span> is the up card, and <span class="math inline">\(h\)</span> and <span class="math inline">\(v\)</span> are hard and soft values, respectively. Let’s start with <span class="math inline">\(S_{(4,2,h)}\)</span> and work our way from there. The only way of winning is when the dealer has <span class="math inline">\(P_{(2,B,h)},\)</span> and all other outcomes result with the dealer winning. This gives <span class="math display">\[S_{(4,2,h)} = P_{(2,B,h)} - \sum_{i=17}^{21} P_{(2,i,h)} \equiv -0.293,\]</span> so the player is expected to lose <span class="math inline">\(0.293\)</span> of their bet by standing. Notice that this is similar for all <span class="math inline">\(4 \le k \le 16\)</span> and all <span class="math inline">\(u,\)</span> since only when <span class="math inline">\(k = 17\)</span> does the probability of beating the dealer begin to change. Thus, we can derive the formula <span class="math display">\[S_{(k,u,h)} = P_{(k,B,h)} - \sum_{i=17}^{21}P_{(k,i,h)}\]</span> for <span class="math inline">\(4 \le k \le 16.\)</span> However, when <span class="math inline">\(k=17,\)</span> a push can occur and neither dealer nor player wins. This gives us the equation <span class="math display">\[S_{(17,u,h)} = P_{(17,B,h)} - \sum_{i=18}^{21}P_{(17,i,h)}.\]</span> When <span class="math inline">\(k = 18,\)</span> a push can occur, or the dealer arrives at <span class="math inline">\(17\)</span> and the player wins. This yields <span class="math display">\[S_{(18,u,h)} = P_{(18,B,h)} + P_{(18,17,h)} - \sum_{i=19}^{21}P_{(18,i,h)},\]</span> and a similar process occurs for <span class="math inline">\(19\)</span> to <span class="math inline">\(21.\)</span> Any hard value higher than <span class="math inline">\(21\)</span> has expected loses of <span class="math inline">\(100\%\)</span> of the player’s bet, as they would already be busted. We get the following chart for hard values:</p>
<p><img src="StandH.png" style="width:10cm" alt="image" /></p>
<p>Soft values from <span class="math inline">\(12\)</span> to <span class="math inline">\(21\)</span> mirror their hard value counterparts since standing is the only option, and soft values <span class="math inline">\(22\)</span> to <span class="math inline">\(31\)</span> also mirror their hard value counterparts, otherwise they would bust. Now, we move on to hitting. We will define <span class="math inline">\(H_{(u,k,h)}\)</span> similar to <span class="math inline">\(S_{(u,k,h)},\)</span> but instead of standing, we hit once (this is a more simplified version, but the results are more or less the same).</p>
<p>Again, we will take <span class="math inline">\(H_{(2,4,h)}\)</span> as an example. There is a <span class="math inline">\(\frac{1}{13}\)</span> chance of getting any of <span class="math inline">\(S_{(2,6,h)}\)</span> through <span class="math inline">\(S_{(2,13,h)},\)</span> a <span class="math inline">\(\frac{4}{13}\)</span> chance of getting <span class="math inline">\(S_{(2,14,h)},\)</span> and a <span class="math inline">\(\frac{1}{13}\)</span> chance of getting <span class="math inline">\(S_{(2,15,v)}.\)</span> This gives <span class="math display">\[H_{(2,4,h)} = \frac{1}{13} \sum_{i=6}^{13} S_{(2,i,h)} + \frac{4}{13} S_{(2,14,h)} + \frac{1}{13} S_{(2,15,s)},\]</span> and we can derive similar values for the remaining numbers. Note, however, that once <span class="math inline">\(k \ge 21,\)</span> the player should expect to lose all of their money after hitting, since then they would bust.</p>
<p>We’ll proceed by finding the expected returns of the soft values. This is nearly identical to the hard values, but instead, all values are soft. When <span class="math inline">\(12 \le k \le 20,\)</span> we have <span class="math display">\[H_{(u,k,s)} = \frac{1}{13} \sum_{i=k+2}^{k+9} S_{(u,i,s)} + \frac{4}{13} S_{(u,k+10,s)} + \frac{1}{13} S_{(u,k+11,s)}.\]</span> Finally, when <span class="math inline">\(k \ge 21,\)</span> we refer to its hard value counterpart. Thus, we get</p>
<p><img src="Hit.png" style="width:10cm" alt="image" /></p>
<p>Now we take the maximum of the stand and hit of each case and make our move accordingly. Note, however, that some results are different from what’s on the professional chart. This is because we assumed that we only hit once and stand afterwards; we could put the values in a recursive relationship that compares hitting and standing to calculate the expected return of multiple hits. Here’s our derived basic strategy table (notice that some of these moves make no sense!)</p>
<p><img src="BasicStrategy.png" style="width:10cm" alt="image" /></p>
<h2 id="betting">Betting</h2>
<p>Betting is surprisingly easy compared to the other aspects of card counting.</p>
<p>Since the player has the first moves and automatically loses if they bust, the house always has the advantage. However, when someone is playing optimally using perfect basic blackjack strategy, they can bring down the house edge to on average <span class="math inline">\(0.5\%\)</span> (this was derived in Stanford Wong’s book <em>Professional Blackjack</em>). Each increment in the true count then brings down the edge by an additional <span class="math inline">\(0.5\%.\)</span></p>
<p>By the Kelly Criterion, which is a way of betting proportionally to the player’s advantage, to earn the most money, bet the player’s advantage proportion of the player’s bankroll. For example, at a true count of <span class="math inline">\(5\)</span> and a bankroll of <span class="math inline">\(\$1000,\)</span> the player’s advantage is <span class="math inline">\(2.0\%\)</span> and the bet should therefore be <span class="math display">\[0.02\cdot \$1000 = \$20\]</span> times the betting percent you wish to make. If the betting percent was <span class="math inline">\(1\%,\)</span> you would bet <span class="math inline">\(20\cdot(0.01\cdot1000)=200\)</span> dollars.</p>
<h1 id="conclusion">Conclusion</h1>
<p>Counting cards is considered legal, but many casinos will probably throw you out if they catch you counting cards. People have come up with strategies to overcome this challenge (watch the movie <em>21</em> if you have time). Additionally, don’t try counting cards online, as the deck is automatically shuffled after each round. Regardless, have fun with your new strategies and try to make some money!</p>
</body>
</html>
